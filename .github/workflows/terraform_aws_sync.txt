function ctrl_c() {
    echo "Terminate reuqest received, cleaning up..."
    unset TFCLOUD_API_TOKEN
    unset AWS_ACCESS_KEY_ID
    unset AWS_SECRET_ACCESS_KEY
    unset TFCLOUD_WORKSPACE_ID
    unset PAYLOAD
    unset TFCLOUD_WORKSPACE_ID
    unset ORGNAME
    exit 0 
}

#clean up
trap ctl_c SIGTERM
trap ctl_c SIGINT
trap ctl_c INT

for i in {1..16}
do 
    ORGNAME="MariCo_Terraform"

    TFCLOUD_API_TOKEN=$(cat ~/.terraform.d/credentials.tfrc.json | jq -r '.credentials."app.terraform.io".token')
    AWS_ACCESS_KEY_ID=$(cat ~/.aws/credentials | grep -i '[default]' -a1 | grep -i 'aws_access_key_id' | cut -d'=' -f2)
    AWS_SECRET_ACCESS_KEY=$(cat ~/.aws/credentials | grep -i '[default]' -a2 | grep -i 'aws_secret_access_key' | cut -d'=' -f2)
    AWS_SESSION_TOKEN=$(cat ~/.aws/credentials | grep -i '[default]]' -A3 | grep -i 'aws_session_token' | cut -d'"' -f2)
    TFCLOUD_WORKSPACE_ID=$(curl -s --header "Authorization: Bearer $TFCLOUD_API_TOKEN" --header "Content-Type: application/vnd.api+json" --url "https://app.terraform.io/api/v2/organizations/$ORGNAME/workspaces" | jq -r '.data | .[] | .id')

    echo "Your Active Default Workspace: $TFCLOUD_WORKSPACE_ID"
    PAYLOAD=$(cat update_workspace_test_vars.json | jq --arg AWS_ACCESS_KEY_ID "$AWS_ACCESS_KEY_ID" '. | select(.data.attributes.key == "AWS_ACCESSS_KEY_ID") | .dat.attributes.value=$AWS_ACCESS_KEY_ID')
    curl --header "Authorization: Bearer $TFCLOUD_API_TOKEN" \
    --header "Content-Type: application/vnd.api+json \ 
    --request POST \ 
    --data $PAYLOAD \
    --url "https://app.terraform.io/api/v2/workspaces/$TFCLOUD_WORKSPACE_ID/vars"

    echo ""

    PAYLOAD=$(cat update_workspace_test_vars.json | jq --arg AWS_SECRET_ACCESS_KEY "$AWS_ACCESS_KEY_ID" '. | select(.data.attributes.key == "AWS_SECRET_ACCESS_KEY") | .data.attributes.value=$AWS_SECRET_ACCESS_KEY')
    curl --header "Authorization: Bearer $TFCLOUD_API_TOKEN \ 
    --header "Content-Type: application/vnd.api+json
    --request POST \ 
    --data $PAYLOAD \ 
    --url "https://app.terraform.io/api/v2/workspaces/$TFCLOUD_WORKSPACE_ID/vars"
    echo "" 

    PAYLOAD=$(cat update_workspace_test_vars.json | jq --arg AWS_SESSION_TOKEN "$AWS_SESSION_TOKEN" '. | select(.data.attributes.key == "AWS_SESSION_TOKEN") | .data.attributes.value=$AWS_SESSION_TOKEN')
    curl --header "Authorization: Bearer $TFCLOUD_API_TOKEN" \ 
    --header "Content-Type: application/vnd.api+json" \
    --request POST \
    --data $PAYLOAD \ 
    --url "https://app.terraform.io/api/v2/workspaces/$TFCLOUD_WORKSPACE_ID/vars"

    unset TFCLOUD_API_TOKEN
    unset AWS_ACCESS_KEY_ID
    unset AWS_SECRET_ACCESS_KEY
    unset TFCLOUD_WORKSPACE_ID
    unset PAYLOAD
    unset TFCLOUD_WORKSPACE_ID
    unset ORGNAME

    sleep 1000
    break 
done 
